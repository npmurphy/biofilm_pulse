# Model


## Compilation of the tools
The tools are need to run thousands of stochastic simulations and produce the files used to generate Figure 6 C D. 


### Linux 
Add the Mono repositories as described here
https://www.mono-project.com/download/stable/.
Then install the `fsharp` package.

In `model/lbstools`  run `bash build.sh`. 

This should download all the dependencies and compile the `custom_sweeper` project and `simple_tracer` and place the binaries in the `build` directory. 

### Windows 
Install F# as described at https://fsharp.org/use/windows/. 

## Running the model with compiled tools
The model and its parameters are defined in the directory `model/luna`.

The basic model is in the file `model/luna/biofilm.crn`. 
The base parameters are in `model/luna/carsten_map_params.crn`. 
The `stress` and `dist` parameters that represent the stress gradient from the top to the bottom of a biofilm are in the file `model/luna/bfsim_stress.crn` 

To run simulation we supplement/overwrite the basic parameters with the settings for our particular simulation. 
Files demonstrating this and set up to run the WT and 2xQP biofilm simulations of Figure 6C and D are:

* `model/luna/bf_sim_wt.sh`
* `model/luna/bf_sim_2xqp.sh`

#### WT Biofilm Simulation example
The command generated by running `bf_sim_wt.sh` should look like
``` bash 
mono custom_sweeper.exe biofilm.crn 
   --simulations 10000
   --seed 5110
   --sweep-file bfsim_stress.crn 
   --output-name bfsim_b_qp 
   --parameters-file carsten_map_params.crn
   --analysis-method bfsim_thresh 
   --parameter-overrides 'pscale_a=0.7;pscale_b=0.25;bA=0.0;uA=0.0;sim_duration=6.5;initial_skip=1800.0;ascale_a=0.0;ascale_b=0.0'
```

## Running the model on Classic DSD 

Our model used the CRN language that runs on the DSD tool [https://www.microsoft.com/en-us/research/project/programming-dna-circuits/](https://www.microsoft.com/en-us/research/project/programming-dna-circuits/).

The file `model/luna/online_biofilm.crn` can be pasted into the CRN tab of the online simulator at
[https://classicdsd.azurewebsites.net/](https://classicdsd.azurewebsites.net/). 
The simulation run time and number of traces can be modified 
in the "directives" tab. 
To run the DSD tool locally download from [https://dsd.azurewebsites.net/server/](https://dsd.azurewebsites.net/server/).



# Parameters for the biofilm simulations 
```python
{
 "a0" : 0.05,
 "ascale_a" : 0.0,
 "ascale_b" : 0.0,
 "b0" : 0.05,
 "bA" : 0.0;
 "bB" : 1.0,
 "dm" : 0.005,
 "dp" : 0.005,
 "initial_skip" : 1800.0,
 "pscale_a" : 0.7,
 "pscale_b" : 0.25,  # WT
 #"pscale_b" : 0.5,  # 2xQP 
 "sim_duration" : 6.5,
 "sim_hour" : 3600.0,
 "sim_minute" : 60.0,
 "trA" : 0.05,
 "trB" : 0.05,
 "uA" : 0.0,
 "uB" : 0.1,
 "stress": 0.005, # The stress used for the simulation trace in Figure 6 B
}
```
The `stress` and `dist` parameters that represent the stress gradient in the biofilm are in the file `model/luna/bfsim_stress.crn` 